Documentazione del Modulo Zabbix API Integration Questo modulo Python fornisce un'interfaccia asincrona per interagire con l'API di Zabbix, consentendo il recupero di informazioni su host, problemi, trigger e template, nonché la creazione di nuovi host. Utilizza FastMCP per esporre le funzionalità come tool e httpx per le richieste HTTP asincrone. Il modulo è configurato per connettersi a un'istanza Zabbix locale e include una mappatura della severità per i problemi. Configurazione Iniziale Il modulo si connette all'API di Zabbix utilizzando le seguenti configurazioni: • ZA BBIX_API : Token API (attualmente un valore hardcoded). • ZA BBIX_URL : URL dell'API JSON-RPC di Zabbix (es. http://localhost:8080/api_jsonrpc.php ). • USER : Nome utente per l'autenticazione Zabbix (es. Admin ). • PA SSWORD : Password per l'autenticazione Zabbix (es. zabbix ). Sono inoltre impostate le variabili d'ambiente FASTMCP_DEBUG e il debugging. Mappatura della Severità Il dizionario FASTMCP_LOG_LEVEL per SEVERITY_MAP traduce i codici di severità numerici di Zabbix in descrizioni leggibili: Codice 0 1 Descrizione Not classified Information Warning 23 4 5 Funzioni Average High Disaster get_auth_token(api_url: str, user: str, password: str) -> str | None Questa funzione asincrona recupera un token di autenticazione dall'API di Zabbix. È utilizzata per stabilire una sessione autenticata con il server Zabbix. Parametri: • api _url (str): L'URL completo dell'endpoint JSON-RPC dell'API di Zabbix. • user (str): Il nome utente per l'autenticazione. • pa ssword (str): La password per l'autenticazione. Valore di Ritorno: • st r | None : Il token di autenticazione se il login ha successo, altrimenti errori di rete, errori HTTP o errori dell'API Zabbix. Comportamento: None in caso di La funzione invia una richiesta POST all'API di Zabbix con il metodo user.login e le credenziali fornite. Gestisce vari tipi di errori, inclusi problemi di rete ( httpx.RequestError ), errori di stato HTTP ( httpx.HTTPStatusError ) ed errori generici. In caso di successo, stampa un messaggio di conferma e restituisce il token. In caso di errore, stampa un messaggio diagnostico. Esempio di Utilizzo: Python # Esempio di utilizzo (assumendo che ZABBIX_URL, USER, PASSWORD siano definiti)auth_token = await get_auth_token(ZABBIX_URL, USER, PASSWORD) if auth_token: print(f"Token di autenticazione: {auth_token}") else: print("Impossibile ottenere il token di autenticazione.") get_hosts_list(search: str = "*") -> Any Questa funzione asincrona recupera un elenco di host dalla Zabbix API. Supporta il filtraggio per nome host e include informazioni sui problemi associati agli host. Parametri: • se arch (str): Un filtro di ricerca per il nome dell'host. Il valore predefinito è "*" , che restituisce tutti gli host. Se viene fornito un nome host specifico, la funzione restituirà solo gli host che corrispondono a quel nome. Valore di Ritorno: • Any : Un elenco di dizionari, dove ogni dizionario rappresenta un host con i suoi dettagli, inclusi hostid , host , lista di problems associati. Comportamento: interfaces (con interfaceid e ip ) e, se applicabile, una search diverso da La funzione si connette alla Zabbix API utilizzando le credenziali predefinite. Se viene fornito un filtro di ricerca ( "*" ), recupera gli host che corrispondono al filtro e, hostid , per ciascuno di essi, recupera anche le informazioni sui problemi attivi tramite la funzione get_hosts_with_problems_info . Se non viene fornito alcun filtro, restituisce tutti gli host con i loro host e interfaces . Gestisce le eccezioni verificarsi durante l'interazione con l'API Zabbix. Esempio di Utilizzo: Python # Recupera tutti gli host all_hosts = await get_hosts_list() print("Tutti gli host:", all_hosts) ModuleBaseException che possono # Recupera un host specifico (es. 'Linux server') specific_host = await get_hosts_list(search="Linux server") print("Host 'Linux server':", specific_host) create_host(search: str = "*") -> Any Questa funzione asincrona crea un nuovo host nella Zabbix API utilizzando un payload predefinito. Attualmente, il parametro search non viene utilizzato all'interno della funzione. Parametri: • se arch (str): Parametro non utilizzato. Il valore predefinito è Valore di Ritorno: "*" . • Any : L'output dell'operazione di creazione dell'host dalla Zabbix API, che include i dettagli dell'host creato. Comportamento: La funzione si connette alla Zabbix API e tenta di creare un host con un set di parametri predefiniti, inclusi nome host ( Linux server ), interfacce, gruppi, tag, template e macro. Gestisce le eccezioni ModuleBaseException che possono verificarsi durante l'interazione con l'API Zabbix. Esempio di Utilizzo: Python # Crea un nuovo host con i parametri predefiniti new_host_info = await create_host() print("Informazioni sul nuovo host creato:", new_host_info) get_all_graph_list(host: str = "*") -> Any Questa funzione asincrona recupera un elenco di grafici dalla Zabbix API. Attualmente, il parametro host non viene utilizzato all'interno della funzione. Parametri:• host (str): Parametro non utilizzato. Il valore predefinito è "*" . Valore di Ritorno: • Any : Un elenco di dizionari, dove ogni dizionario rappresenta un grafico con i suoi dettagli estesi. Comportamento: La funzione si connette alla Zabbix API e recupera i grafici utilizzando i parametri predefiniti per l'output esteso, l'ordinamento per eventid in ordine decrescente e un limite di 10 risultati. Gestisce le eccezioni ModuleBaseException che possono verificarsi durante l'interazione con l'API Zabbix. Esempio di Utilizzo: Python # Recupera tutti i grafici all_graphs = await get_all_graph_list() print("Tutti i grafici:", all_graphs) get_graph_from_host(hostids: str = "*") -> Any Questa funzione asincrona recupera informazioni sui grafici associati a uno o più host specifici dalla Zabbix API. Parametri: • hos tids (str): L'ID dell'host o una lista di ID host per filtrare i grafici. Il valore predefinito è "*" , che non dovrebbe essere usato in questo contesto, poiché la funzione è pensata per host specifici. È consigliabile passare un ID host valido. Valore di Ritorno: • Any : Un elenco di dizionari, dove ogni dizionario rappresenta un grafico con i suoi dettagli estesi. Comportamento:La funzione si connette alla Zabbix API e recupera i grafici filtrando per gli hostids forniti. L'output è esteso e ordinato per nome. Gestisce le eccezioni ModuleBaseException che possono verificarsi durante l'interazione con l'API Zabbix. Esempio di Utilizzo: Python # Recupera i grafici per un host specifico (sostituire '10084' con un hostid valido) host_graphs = await get_graph_from_host(hostids="10084") print("Grafici per l'host specificato:", host_graphs) get_hosts_with_problems_info(host: str = "*", recent: bool = True) -> dict Questa funzione asincrona recupera i dettagli dei problemi attivi da Zabbix. Se viene specificato un host, recupera i problemi relativi a quell'host. I problemi vengono raggruppati per hostid . Parametri: • host (str): Un filtro di ricerca per il nome dell'host. Il valore predefinito è "*" , che recupera i problemi per tutti gli host. Attualmente, questo parametro non viene utilizzato per filtrare la chiamata API, ma per la struttura dell'output. • rec ent (bool): Se True , vengono restituiti solo i problemi recenti. Il valore predefinito è True . Valore di Ritorno: • dict : Un dizionario dove le chiavi sono gli host_name , una lista di hostid e i valori sono dizionari contenenti problems (con event_id , description , templates (attualmente vuota). Comportamento: severity ) e una lista La funzione si connette alla Zabbix API e recupera i problemi utilizzando i parametri predefiniti per l'output esteso, l'ordinamento per eventid in ordine decrescente. I problemi vengono poi iterati e raggruppati per objectid (che corrisponde all'hostid). Per ogni problema, vengono estratti l'ID dell'evento, la descrizione e la severità (tradotta usando SEVERITY_MAP ). Gestisce le eccezioni ModuleBaseException . Esempio di Utilizzo: Python # Recupera i problemi per tutti gli host all_problems = await get_hosts_with_problems_info() print("Problemi per tutti gli host:", all_problems) # Recupera i problemi recenti per un host specifico (se il filtro fosse implementato a livello API) # current_host_problems = await get_hosts_with_problems_info(host="NomeHostSpecifico", recent=True) # print("Problemi recenti per host specifico:", current_host_problems) get_trigger_list(host: str = "*", hostids: str = "*", triggerids: str = "*", problem_state: int = 1) -> Any Questa funzione asincrona recupera un elenco di trigger da Zabbix. Permette di filtrare i trigger per nome host, ID host o ID trigger. È possibile specificare se restituire tutti i trigger o solo quelli in stato di problema. Parametri: • host (str): Nome dell'host per filtrare i trigger. Il valore predefinito è per nome host). • hos "*" (nessun filtro tids (str): ID dell'host per filtrare i trigger. Il valore predefinito è "*" (nessun filtro per ID host). • tr iggerids (str): ID del trigger per filtrare i trigger. Il valore predefinito è f iltro per ID trigger). • p roblem_state (int): Se 0 , restituisce tutti i trigger. Se restituisce solo i trigger in stato di problema. "*" (nessun 1 (valore predefinito), Valore di Ritorno:• Any : Un elenco di dizionari, dove ogni dizionario rappresenta un trigger con i suoi dettagli, inclusi triggerid , templateid , event_name e comments . Comportamento: description , priority , hosts , La funzione costruisce un payload per la richiesta state , trigger.get dell'API Zabbix, applicando i f iltri forniti. I trigger vengono ordinati per priorità e data di ultima modifica in ordine decrescente. Gestisce le eccezioni ModuleBaseException che possono verificarsi durante l'interazione con l'API Zabbix. Esempio di Utilizzo: Python # Recupera tutti i trigger in stato di problema problem_triggers = await get_trigger_list() print("Trigger in stato di problema:", problem_triggers) # Recupera tutti i trigger (indipendentemente dallo stato) all_triggers = await get_trigger_list(problem_state=0) print("Tutti i trigger:", all_triggers) # Recupera i trigger per un host specifico (es. hostids="10084") host_triggers = await get_trigger_list(hostids="10084") print("Trigger per host 10084:", host_triggers) get_trigger_problems(trigger: str = "*", hostids: str = "*", host: str = "*", recent: bool = True) -> Any Questa funzione asincrona recupera un elenco di problemi dei trigger da Zabbix. Permette di filtrare i problemi per ID trigger, ID host o nome host. Parametri: • trigger (str): ID del trigger per filtrare i problemi. Il valore predefinito è f iltro per ID trigger). • hos "*" (nessun tids (str): ID dell'host per filtrare i problemi. Il valore predefinito è "*" (nessun f iltro per ID host).• host (str): Nome dell'host per filtrare i problemi. Il valore predefinito è "*" (nessun f iltro per nome host). • rec ent (bool): Se True , vengono restituiti solo i problemi recenti. Il valore predefinito è True . Valore di Ritorno: • Any : Un elenco di dizionari, dove ogni dizionario rappresenta un problema di trigger con i suoi dettagli estesi, inclusi triggerid , state , event_name , templateid , description , priority , comments , acknowledges , tags e suppressionData . Comportamento: La funzione costruisce due payload ( payload_0 e hosts , payload ) per la richiesta trigger.get dell'API Zabbix, applicando i filtri forniti. I problemi vengono ordinati per eventid in ordine decrescente. Gestisce le eccezioni ModuleBaseException che possono verificarsi durante l'interazione con l'API Zabbix. Esempio di Utilizzo: Python # Recupera tutti i problemi dei trigger recenti recent_trigger_problems = await get_trigger_problems() print("Problemi dei trigger recenti:", recent_trigger_problems) # Recupera i problemi per un trigger specifico (es. trigger="12345") specific_trigger_problems = await get_trigger_problems(trigger="12345") print("Problemi per trigger 12345:", specific_trigger_problems) get_all_templates() -> Any Questa funzione asincrona recupera un elenco di tutti i template configurati nella Zabbix API. Parametri: • Nessuno.Valore di Ritorno: • Any : Un elenco di dizionari, dove ogni dizionario rappresenta un template con i suoi dettagli estesi, inclusi i gruppi e gli host associati. Comportamento: La funzione si connette alla Zabbix API e recupera tutti i template utilizzando i parametri predefiniti per l'output esteso, includendo i gruppi e gli host associati. Gestisce le eccezioni ModuleBaseException che possono verificarsi durante l'interazione con l'API Zabbix. Esempio di Utilizzo: Python # Recupera tutti i template all_templates = await get_all_templates() print("Tutti i template:", all_templates) generate_html_table(hosts_data) -> str Questa funzione genera una stringa HTML che rappresenta una tabella basata sui dati degli host forniti, tipicamente dall'output JSON di Zabbix. Parametri: • ho sts_data (list): Una lista di dizionari, dove ogni dizionario contiene le informazioni di un host, inclusi hostid , host e Valore di Ritorno: interfaces . • str : Una stringa HTML ben formattata che rappresenta una tabella con le colonne 'Host ID', 'Host Name', 'Interface ID' e 'IP Address'. Comportamento: La funzione costruisce una tabella HTML che visualizza i dettagli degli host e delle loro interfacce. Include stili CSS inline per una migliore leggibilità. Itera sui dati degli host e, per ogni host, itera sulle sue interfacce per creare righe separate nella tabella. Se un host non ha interfacce, le colonne 'Interface ID' e 'IP Address' mostreranno 'N/A'.Esempio di Utilizzo: Python # Esempio di dati host (tipicamente dall'output di get_hosts_list) example_hosts_data = [ { "hostid": "10084", "host": "Zabbix server", "interfaces": [ { "interfaceid": "1", "ip": "127.0.0.1" } ] }, { "hostid": "10085", "host": "Another server", "interfaces": [] } ] html_output = generate_html_table(example_hosts_data) print(html_output)

# Zabbix MCP Server

A comprehensive Model Context Protocol (MCP) server for Zabbix integration using FastMCP and python-zabbix-utils. This server provides complete access to Zabbix API functionality through MCP-compatible tools.

## Features

### Host Management
- `host_get` - Retrieve hosts with advanced filtering
- `host_create` - Create new hosts with interfaces and templates
- `host_update` - Update existing host configurations
- `host_delete` - Remove hosts from monitoring

### Host Group Management
- `hostgroup_get` - Retrieve host groups
- `hostgroup_create` - Create new host groups
- `hostgroup_update` - Modify existing host groups
- `hostgroup_delete` - Remove host groups

### Item Management
- `item_get` - Retrieve monitoring items with filtering
- `item_create` - Create new monitoring items
- `item_update` - Update existing items
- `item_delete` - Remove monitoring items

### Trigger Management
- `trigger_get` - Retrieve triggers and alerts
- `trigger_create` - Create new triggers
- `trigger_update` - Modify existing triggers
- `trigger_delete` - Remove triggers

### Template Management
- `template_get` - Retrieve monitoring templates
- `template_create` - Create new templates
- `template_update` - Update existing templates
- `template_delete` - Remove templates

### Problem & Event Management
- `problem_get` - Retrieve current problems and issues
- `event_get` - Get historical events
- `event_acknowledge` - Acknowledge events and problems

### Data Retrieval
- `history_get` - Access historical monitoring data
- `trend_get` - Retrieve trend data and statistics

### User Management
- `user_get` - Retrieve user accounts
- `user_create` - Create new users
- `user_update` - Update user information
- `user_delete` - Remove user accounts

### Proxy Management
- `proxy_get` - Retrieve Zabbix proxies with filtering
- `proxy_create` - Create new proxies
- `proxy_update` - Update existing proxies
- `proxy_delete` - Remove proxies

### Maintenance Management
- `maintenance_get` - Retrieve maintenance periods
- `maintenance_create` - Schedule maintenance windows
- `maintenance_update` - Modify maintenance periods
- `maintenance_delete` - Remove maintenance schedules

### Additional Features
- `graph_get` - Retrieve graph configurations
- `discoveryrule_get` - Get discovery rules
- `itemprototype_get` - Retrieve item prototypes
- `configuration_export` - Export Zabbix configurations
- `configuration_import` - Import configurations
- `apiinfo_version` - Get API version information

